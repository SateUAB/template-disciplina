<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planejamento de Disciplina - SATE/UECE</title>

    <!-- Bibliotecas para Word e Fonte -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
    <!-- Biblioteca para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* --- Identidade Visual Cear√° (Verde & Ouro) --- */

            /* Verde Institucional (Principal) */
            --primary: #006935;
            --primary-light: #008f4c;

            /* Amarelo Ouro (Secund√°rio/Avalia√ß√µes) */
            --gold: #d97706;
            /* Tom Ouro Escuro para texto/bordas */
            --gold-light: #f59e0b;
            /* Tom Ouro Vibrante */
            --gold-glow: rgba(245, 158, 11, 0.2);
            --gold-bg: #fffbeb;

            /* Neutros */
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;

            /* Degrad√™s */
            --gradient-header: linear-gradient(135deg, #004d25 0%, #007a3d 100%);
            --gradient-btn-primary: linear-gradient(135deg, #006935 0%, #008f4c 100%);
            --gradient-btn-gold: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);

            /* Sombras & Bordas */
            --radius-lg: 1rem;
            --radius-md: 0.75rem;
            --radius-sm: 0.5rem;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-glow-green: 0 0 0 4px rgba(0, 105, 53, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
        }

        /* --- Header --- */
        .main-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: var(--gradient-header);
            border-radius: var(--radius-lg);
            color: white;
            box-shadow: 0 20px 40px -10px rgba(0, 77, 37, 0.3);
            position: relative;
            overflow: hidden;
            border-bottom: 6px solid var(--gold-light);
            /* Faixa amarela na base */
        }

        .main-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.03em;
        }

        .main-header h2 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 8px;
            text-transform: uppercase;
        }

        /* --- Cart√µes --- */
        .card {
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
            border: 1px solid white;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            padding: 20px 32px;
            background: white;
            border-bottom: 1px solid var(--border);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            display: flex;
            align-items: center;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .step-badge {
            background: var(--gradient-btn-primary);
            color: white;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: 800;
            font-size: 1rem;
        }

        .card-body {
            padding: 32px;
        }

        /* --- Inputs Padr√£o (Verde) --- */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.95rem;
            color: var(--text-main);
            background-color: #fff;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: var(--shadow-glow-green);
        }

        /* Placeholder styling */
        ::placeholder {
            color: #94a3b8;
            font-size: 0.85rem;
            font-weight: 400;
        }

        /* --- Estilo Especial para Avalia√ß√µes (Amarelo Ouro) --- */
        .evaluation input:focus,
        .evaluation select:focus,
        .evaluation textarea:focus {
            border-color: var(--gold-light) !important;
            box-shadow: 0 0 0 4px var(--gold-glow) !important;
        }

        .evaluation .datetime-group:focus-within {
            border-color: var(--gold-light) !important;
            box-shadow: var(--gold-glow) !important;
        }

        /* --- M√≥dulos e Itens --- */
        .item-card {
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 0;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .item-card:hover {
            border-color: #cbd5e1;
        }

        .item-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: var(--primary);
            /* Verde padr√£o */
        }

        /* Faixa Amarela para Avalia√ß√£o */
        .item-card.evaluation::before {
            background: var(--gold);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
        }

        .item-title {
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
            text-transform: uppercase;
        }

        .evaluation .item-title {
            color: var(--gold);
        }

        .item-body {
            padding: 24px;
        }

        /* Recursos */
        .resource-item {
            background: #fdfdfd;
            border: 1px dashed #cbd5e1;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-top: 15px;
            position: relative;
            border-left: 5px solid var(--text-muted);
            transition: all 0.2s ease;
        }

        .resource-item:hover {
            background: #fff;
            border-style: solid;
            border-color: var(--primary-light);
            border-left-color: var(--primary);
            transform: scale(1.005);
        }

        .resource-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e2e8f0;
        }

        .resource-label {
            color: var(--text-muted);
            background: #f1f5f9;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .resource-item:hover .resource-label {
            color: var(--primary);
            background: #f0fdf4;
        }

        /* --- Grupo Data/Hora --- */
        .datetime-group {
            background: white;
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .datetime-group:focus-within {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-glow-green);
        }

        .datetime-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0;
        }

        .toggle-select {
            padding: 6px 12px;
            font-size: 0.8rem;
            border: 1px solid #e2e8f0;
            background: #f1f5f9;
            color: var(--text-main);
            border-radius: 6px;
            font-weight: 600;
        }

        .date-inputs-container {
            display: none;
            gap: 12px;
            border-top: 1px dashed var(--border);
            padding-top: 12px;
            margin-top: 12px;
            animation: fadeInSlide 0.3s ease-out;
        }

        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Bot√µes --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 0.95rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: none;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .btn-solid-blue {
            background: var(--gradient-btn-primary);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 105, 53, 0.2);
            width: 100%;
        }

        .btn-solid-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 105, 53, 0.3);
        }

        /* Bot√£o Remover */
        .btn-remove {
            padding: 6px 16px;
            font-size: 0.75rem;
            background: white;
            color: var(--text-muted);
            border: 1px solid var(--border);
            border-radius: 99px;
            text-transform: uppercase;
            font-weight: 700;
            margin-left: auto;
        }

        .btn-remove:hover {
            color: var(--gold);
            border-color: var(--gold);
            background: var(--gold-bg);
        }

        .btn-generate {
            background: var(--gradient-btn-gold);
            color: white;
            width: 100%;
            padding: 20px;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-md);
            box-shadow: 0 10px 20px rgba(217, 119, 6, 0.2);
        }

        .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(217, 119, 6, 0.3);
        }

        .btn-pdf {
            background: var(--gradient-btn-primary);
            color: white;
            width: 100%;
            padding: 20px;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-md);
            box-shadow: 0 10px 20px rgba(0, 105, 53, 0.2);
        }

        .btn-pdf:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 105, 53, 0.3);
        }

        /* --- Avisos --- */
        .notice-box {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: flex-start;
            border-left: 5px solid transparent;
            box-shadow: var(--shadow-md);
        }

        .notice-info {
            background: #f0fdf4;
            color: #166534;
            border-left-color: var(--primary);
        }

        .notice-warning {
            background: #fffbeb;
            color: #92400e;
            border-left-color: var(--gold);
        }

        .notice-danger {
            background: #fef2f2;
            color: #991b1b;
            border-left-color: #ef4444;
        }

        /* --- P.S. e Observa√ß√µes --- */
        .ps-note {
            font-size: 0.85rem;
            color: #78350f;
            background-color: #fffbeb;
            padding: 14px 18px;
            border-radius: var(--radius-md);
            margin-top: 14px;
            border: 1px solid #fcd34d;
            border-left: 5px solid var(--gold);
        }

        .ps-note strong {
            color: var(--gold);
            font-weight: 800;
            text-transform: uppercase;
            margin-right: 4px;
        }

        .auto-eval-msg {
            display: none;
            background-color: #f0f9ff;
            color: #0369a1;
            padding: 16px;
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid #bae6fd;
            border-left: 5px solid #0ea5e9;
            font-size: 0.9rem;
            font-weight: 700;
            margin-top: 16px;
        }

        /* --- Grid & Tabela --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
        }

        .col-12 {
            grid-column: span 12;
        }

        .col-9 {
            grid-column: span 9;
        }

        .col-8 {
            grid-column: span 8;
        }

        .col-6 {
            grid-column: span 6;
        }

        .col-4 {
            grid-column: span 4;
        }

        .col-3 {
            grid-column: span 3;
        }

        .hidden {
            display: none !important;
        }

        .sub-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-muted);
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
        }

        .table-wrapper {
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: #f8fafc;
            color: var(--text-muted);
            padding: 16px 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        td {
            padding: 12px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        /* -- CORRE√á√ÉO DOS INPUTS DA TABELA -- */
        td input {
            background: #ffffff;
            border: 1px solid var(--border);
            /* Borda vis√≠vel */
            border-radius: var(--radius-sm);
            padding: 8px 12px;
            transition: all 0.2s ease;
        }

        td input:hover {
            border-color: #cbd5e1;
        }

        td input:focus {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-glow-green);
            outline: none;
        }

        @media(max-width: 768px) {

            .col-12,
            .col-9,
            .col-8,
            .col-6,
            .col-4,
            .col-3 {
                grid-column: span 12;
            }

            .date-inputs-container {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="main-header">
            <h1>Planejamento de Disciplina</h1>
            <h2>SATE / UECE</h2>
        </div>

        <div class="notice-box notice-info">
            <span class="icon">‚ÑπÔ∏è</span>
            <div>
                <strong>Prazos e Fluxo:</strong>
                <ul style="margin: 5px 0 0 15px; padding:0; list-style: circle;">
                    <li>Implanta√ß√£o de Disciplinas: <strong>14 dias √∫teis</strong></li>
                    <li>Provas Online: <strong>45 dias √∫teis</strong></li>
                    <li>Suporte: 48h a 72h</li>
                </ul>
                <div style="margin-top:8px; font-size:0.85rem;">Enviar arquivo gerado para:
                    <strong>atendimentosate@uece.br</strong></div>
            </div>
        </div>

        <form id="formPlanejamento">

            <!-- Identifica√ß√£o -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">1</span> Identifica√ß√£o</div>
                </div>
                <div class="card-body">
                    <div class="grid">
                        <div class="col-3"> <label>Turma</label> <input type="text" id="id_turma"
                                placeholder="COLOCAR A TURMA"> </div>
                        <div class="col-3"> <label>Semestre</label> <input type="text" id="id_semestre"
                                placeholder="Ex: 2024.1"> </div>
                        <div class="col-6"> <label>Curso</label> <input type="text" id="id_curso"> </div>
                        <div class="col-8"> <label>Disciplina</label> <input type="text" id="id_disciplina"
                                placeholder="NOME DA DISCIPLINA"> </div>
                        <div class="col-4"> <label>Carga Hor√°ria</label> <input type="text" id="id_ch"
                                placeholder="CARGA HOR√ÅRIA"> </div>
                        <div class="col-12"> <label>Polos</label> <input type="text" id="id_polos"> </div>
                    </div>
                </div>
            </div>

            <!-- Material -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">2</span> Material Did√°tico</div>
                </div>
                <div class="card-body">
                    <div class="grid">
                        <div class="col-12"> <label>Link do Livro (Biblioteca)</label> <input type="url" id="mat_livro"
                                placeholder="Colocar o link do arquivo alocado na biblioteca da UECE"> </div>
                        <div class="col-12"> <label>Material Adicional</label> <textarea id="mat_adicional"
                                placeholder="ARTIGOS E DOCUMENTOS OFICIAIS, V√çDEOS, SLIDES..."></textarea> </div>
                        <div class="col-12">
                            <div class="notice-box notice-danger" style="margin-bottom:0;">
                                <span class="icon">üõë</span>
                                <div><strong>Direitos Autorais:</strong> A reprodu√ß√£o n√£o autorizada √© pass√≠vel de
                                    puni√ß√£o.</div>
                            </div>
                        </div>

                        <!-- NOVO CAMPO WEBCONF COM SELETOR -->
                        <div class="col-12">
                            <label>Webconf / Sala Virtual</label>
                            <div class="grid" style="gap: 12px; grid-template-columns: 1fr 2fr;">
                                <div style="grid-column: span 1;">
                                    <select id="webconf_type" onchange="toggleWebconfInput(this)">
                                        <option value="padrao">Ferramenta Padr√£o (Moodle)</option>
                                        <option value="personalizado">Link Personalizado (RNP)</option>
                                    </select>
                                </div>
                                <div style="grid-column: span 1;" id="webconf_url_container" class="hidden">
                                    <input type="url" id="mat_webconf"
                                        placeholder="Cole o link da sua sala RNP aqui...">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- M√≥dulos -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">3</span> Conte√∫do (M√≥dulos)</div>
                </div>
                <div class="card-body">
                    <div id="modulesContainer"></div>
                    <button type="button" class="btn btn-solid-blue" onclick="addModule()">+ Adicionar Novo
                        M√≥dulo</button>
                </div>
            </div>

            <!-- Avalia√ß√µes -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">4</span> Avalia√ß√µes</div>
                </div>
                <div class="card-body">
                    <div class="notice-box notice-warning">
                        <span class="icon">‚ö†Ô∏è</span>
                        <div><strong>Aten√ß√£o ao Prazo:</strong> Implanta√ß√£o de Provas Online requer <strong>45 dias
                                √∫teis</strong> de anteced√™ncia.</div>
                    </div>
                    <div id="evaluationsContainer"></div>
                    <button type="button" class="btn btn-solid-blue" style="margin-top:20px;"
                        onclick="addEvaluation()">+ Adicionar Outra Avalia√ß√£o</button>
                </div>
            </div>

            <!-- C√ÅLCULO DE NOTAS (NOVO PASSO 5) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">5</span> C√°lculo de Notas</div>
                </div>
                <div class="card-body">
                    <div class="grid">
                        <div class="col-6">
                            <label>NPC 1</label>
                            <input type="text" id="calc_npc1" placeholder="Avalia√ß√£o (NPC)">
                        </div>
                        <div class="col-6">
                            <label>NPC 2</label>
                            <input type="text" id="calc_npc2" placeholder="M√©dia das atividades + M√©dia dos f√≥runs">
                        </div>
                        <div class="col-12">
                            <label>M√©dia Final</label>
                            <textarea id="calc_media" rows="2"
                                placeholder="((NPC1*5) + (NPC2*4) + (AUTOAVALIA√á√ÉO*1)) / 10"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Frequ√™ncia (AGORA PASSO 6) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="step-badge">6</span> Frequ√™ncia</div>
                </div>
                <div class="card-body">
                    <div class="notice-box notice-danger">
                        <span class="icon">‚ÑπÔ∏è</span>
                        <div>* A carga hor√°ria m√°xima de uma atividade √© 23h.</div>
                    </div>
                    <div class="table-wrapper">
                        <table class="freq-table" id="freqTable">
                            <thead>
                                <tr>
                                    <th width="30%">Data</th>
                                    <th width="20%">CH (0-23)</th>
                                    <th>Descri√ß√£o da Atividade</th>
                                    <th width="5%"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="date" class="freq-data"></td>
                                    <td><input type="number" class="freq-ch" min="0" max="23"
                                            oninput="calculateTotalCH()"></td>
                                    <td><input type="text" class="freq-desc"></td>
                                    <td></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr style="background-color: #f8fafc;">
                                    <td style="text-align:right; font-weight:bold;">Total Carga Hor√°ria:</td>
                                    <td><input type="text" id="total_ch" readonly
                                            style="font-weight:bold; color:var(--primary);"></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <button type="button" class="btn btn-solid-blue"
                        style="width:auto; margin-top:15px; display:flex; margin-left:auto;" onclick="addFreqRow()">+
                        Inserir Data na Frequ√™ncia</button>
                </div>
            </div>

            <div style="display: flex; gap: 20px; margin-top: 40px;">
                <button type="button" class="btn btn-generate" onclick="generateWord()">üì• Gerar Arquivo Word
                    (.docx)</button>
                <button type="button" class="btn btn-pdf" onclick="generatePDF()">üìÑ Gerar Arquivo PDF (.pdf)</button>
            </div>

            <br><br>
        </form>
    </div>

    <script>
        window.onload = function () {
            addModule();
            addEvaluation('Autoavalia√ß√£o');
            addEvaluation('NPC');
            addEvaluation('2¬™ Chamada NPC');
            addEvaluation('NEF');
        };

        function toggleDateVisibility(selectElement) {
            const group = selectElement.closest('.datetime-group');
            const container = group.querySelector('.date-inputs-container');
            if (selectElement.value === 'Sim') container.style.display = 'flex';
            else container.style.display = 'none';
        }

        // --- NOVA FUN√á√ÉO PARA O CAMPO DE WEBCONF ---
        function toggleWebconfInput(selectElement) {
            const container = document.getElementById('webconf_url_container');
            if (selectElement.value === 'personalizado') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function toggleEvalMethod(selectElement) {
            const container = selectElement.closest('.grid');
            const scoreInput = container.querySelector('.val-score');
            const rubricInput = container.querySelector('.val-rubric');
            scoreInput.classList.add('hidden');
            rubricInput.classList.add('hidden');
            if (selectElement.value === 'Pontua√ß√£o') {
                scoreInput.classList.remove('hidden'); rubricInput.value = '';
            } else if (selectElement.value === 'R√∫brica') {
                rubricInput.classList.remove('hidden'); scoreInput.value = '';
            }
        }

        function checkAutoEvaluation(selectElement) {
            const card = selectElement.closest('.item-card');
            const commonFields = card.querySelectorAll('.common-eval-fields');
            const autoMsg = card.querySelector('.auto-eval-msg');
            if (selectElement.value === 'Autoavalia√ß√£o') {
                commonFields.forEach(el => el.classList.add('hidden'));
                autoMsg.style.display = 'block';
            } else {
                commonFields.forEach(el => el.classList.remove('hidden'));
                autoMsg.style.display = 'none';
            }
        }

        function calculateTotalCH() {
            let total = 0;
            document.querySelectorAll('.freq-ch').forEach(input => {
                const val = parseInt(input.value);
                if (!isNaN(val)) total += val;
            });
            document.getElementById('total_ch').value = total;
        }

        function formatDateTime(dateVal, timeVal, toggleVal) {
            if (toggleVal === 'N√£o') return "---";
            if (!dateVal) return "Data n√£o informada";
            const parts = dateVal.split('-');
            return `${parts[2]}/${parts[1]}/${parts[0]} √†s ${timeVal ? timeVal : "00:00"}`;
        }

        let moduleCount = 0;
        function addModule() {
            moduleCount++;
            const container = document.getElementById('modulesContainer');
            const index = moduleCount;
            const div = document.createElement('div');
            div.className = 'item-card';
            div.innerHTML = `
            <div class="item-header"><span class="item-title">M√≥dulo ${index}</span><button type="button" class="btn btn-remove" onclick="this.closest('.item-card').remove()">Remover</button></div>
            <div class="item-body">
                <div class="grid">
                    <div class="col-12"><label>T√≠tulo do M√≥dulo</label><input type="text" class="mod-tema" placeholder="COLOCAR O TEMA DO M√ìDULO"></div>
                    <div class="col-12"><label>Conte√∫do Introdut√≥rio</label><textarea class="mod-intro" style="min-height:60px;" placeholder="Neste espa√ßo colocar algum v√≠deo, imagem ou objetivos relacionados ao tema..."></textarea></div>
                </div>
                <div style="margin-top:25px; padding-top:20px; border-top:1px dashed var(--border);">
                    <label style="color:var(--text-muted); font-size:0.85rem; margin-bottom:15px; display:block;">Recursos deste m√≥dulo:</label>
                    <div class="resources-container"></div>
                    <button type="button" class="btn btn-solid-blue" style="font-size:0.9rem; padding:10px;" onclick="addResource(this)">+ Adicionar Recurso</button>
                </div>
            </div>`;
            container.appendChild(div);
        }

        function addResource(btn) {
            const container = btn.previousElementSibling;
            const div = document.createElement('div');
            div.className = 'resource-item';
            div.innerHTML = `
            <div class="resource-header"><span class="resource-label">Novo Recurso</span><button type="button" class="btn btn-remove" onclick="this.closest('.resource-item').remove()">REMOVER</button></div>
            <div class="grid">
                <div class="col-4"><label>Tipo</label><select class="res-type"><option>F√≥rum</option><option>Tarefa</option><option>Question√°rio</option><option>Wiki</option></select></div>
                <div class="col-8"><label>T√≠tulo</label><input type="text" class="res-title"></div>
                <div class="col-12"><div class="grid" style="gap:16px;">
                    <div class="col-6"><div class="datetime-group"><div class="datetime-header"><label style="margin:0;">Data de Abertura</label><select class="toggle-select start-toggle" onchange="toggleDateVisibility(this)"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select></div><div class="date-inputs-container"><div style="flex:2"><span class="sub-label">Dia</span><input type="date" class="res-start-date"></div><div style="flex:1"><span class="sub-label">Hora</span><input type="time" class="res-start-time"></div></div></div></div>
                    <div class="col-6"><div class="datetime-group"><div class="datetime-header"><label style="margin:0;">Data de Encerramento</label><select class="toggle-select end-toggle" onchange="toggleDateVisibility(this)"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select></div><div class="date-inputs-container"><div style="flex:2"><span class="sub-label">Dia</span><input type="date" class="res-end-date"></div><div style="flex:1"><span class="sub-label">Hora</span><input type="time" class="res-end-time"></div></div></div></div>
                </div></div>
                <div class="col-12"><div class="grid" style="gap:10px; align-items:end;">
                    <div class="col-6"><label>M√©todo Avaliativo</label><select class="eval-method" onchange="toggleEvalMethod(this)"><option value="Nenhum">Nenhum</option><option value="Pontua√ß√£o">Pontua√ß√£o</option><option value="R√∫brica">R√∫brica</option></select></div>
                    <div class="col-6"><input type="number" class="val-score hidden" placeholder="Nota"><input type="text" class="val-rubric hidden" placeholder="R√∫brica"></div>
                </div></div>
                <div class="col-12"><label>Descri√ß√£o / Link</label><textarea class="res-desc" rows="2" placeholder="Colocar o questionamento para intera√ß√£o ou realiza√ß√£o da atividade. Pode incluir v√≠deos, imagens e artigos."></textarea></div>
            </div>`;
            container.appendChild(div);
        }

        function addEvaluation(defaultType = '') {
            const container = document.getElementById('evaluationsContainer');
            const div = document.createElement('div');
            div.className = 'item-card evaluation evaluation-item';
            const isAuto = defaultType === 'Autoavalia√ß√£o';
            const hiddenClass = isAuto ? 'hidden' : '';
            const msgDisplay = isAuto ? 'block' : 'none';
            const sel = (val) => defaultType === val ? 'selected' : '';

            div.innerHTML = `
            <div class="item-header"><span class="item-title">Avalia√ß√£o</span><button type="button" class="btn btn-remove" onclick="this.closest('.evaluation-item').remove()">REMOVER</button></div>
            <div class="item-body">
                <div class="grid">
                    <div class="col-3"><label>Identifica√ß√£o</label><select class="eval-id" onchange="checkAutoEvaluation(this)"><option value="Autoavalia√ß√£o" ${sel('Autoavalia√ß√£o')}>Autoavalia√ß√£o</option><option value="NPC" ${sel('NPC')}>NPC</option><option value="2¬™ Chamada NPC" ${sel('2¬™ Chamada NPC')}>2¬™ Chamada NPC</option><option value="NEF" ${sel('NEF')}>NEF</option><option value="2¬™ Chamada NEF">2¬™ Chamada NEF</option></select></div>
                    <div class="col-9 common-eval-fields ${hiddenClass}"><label>Tipo de Recurso</label><input type="text" class="eval-type" placeholder="Ex: semin√°rio, question√°rio, atividade, wiki..."></div>
                    <div class="col-12"><div class="grid" style="gap:16px;">
                        <div class="col-6"><div class="datetime-group"><div class="datetime-header"><label style="margin:0;">Data de Abertura</label><select class="toggle-select start-toggle" onchange="toggleDateVisibility(this)"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select></div><div class="date-inputs-container"><div style="flex:2"><span class="sub-label">Dia</span><input type="date" class="eval-start-date"></div><div style="flex:1"><span class="sub-label">Hora</span><input type="time" class="eval-start-time"></div></div></div></div>
                        <div class="col-6"><div class="datetime-group"><div class="datetime-header"><label style="margin:0;">Data de Encerramento</label><select class="toggle-select end-toggle" onchange="toggleDateVisibility(this)"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select></div><div class="date-inputs-container"><div style="flex:2"><span class="sub-label">Dia</span><input type="date" class="eval-end-date"></div><div style="flex:1"><span class="sub-label">Hora</span><input type="time" class="eval-end-time"></div></div></div></div>
                    </div></div>
                    <div class="col-12 common-eval-fields ${hiddenClass}"><div class="grid" style="align-items:end;"><div class="col-6"><label>M√©todo Avaliativo</label><select class="eval-method" onchange="toggleEvalMethod(this)"><option value="Nenhum">Nenhum</option><option value="Pontua√ß√£o">Pontua√ß√£o</option><option value="R√∫brica">R√∫brica</option></select></div><div class="col-6"><input type="number" class="val-score hidden" placeholder="Nota"><input type="text" class="val-rubric hidden" placeholder="R√∫brica"></div></div></div>
                    <div class="col-12 common-eval-fields ${hiddenClass}"><label>Descri√ß√£o / Enunciado / Link</label><textarea class="eval-desc" rows="3" placeholder="Colocar o texto da avalia√ß√£o (se for question√°rio, colocar o banco de quest√µes em anexo)."></textarea><div class="ps-note"><strong>P.S:</strong> Se for banco, informar: configura√ß√µes, tempo, qtd quest√µes e senha.</div></div>
                    <div class="col-12 auto-eval-msg" style="display:${msgDisplay};">A configura√ß√£o padr√£o ser√° aplicada. Caso a sua seja diferente, favor informar os detalhes no corpo do chamado (e-mail).</div>
                </div>
            </div>`;
            container.appendChild(div);
        }

        function addFreqRow() {
            const tbody = document.querySelector('#freqTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `<td><input type="date" class="freq-data"></td><td><input type="number" class="freq-ch" min="0" max="23" oninput="calculateTotalCH()"></td><td><input type="text" class="freq-desc"></td><td><button type="button" class="btn btn-remove" onclick="this.closest('tr').remove(); calculateTotalCH();">X</button></td>`;
            tbody.appendChild(tr);
        }

        // --- GERAR DOCX ---
        function generateWord() {
            const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType, TextRun, BorderStyle, ShadingType, AlignmentType, VerticalAlign } = docx;
            const borderStyle = { style: BorderStyle.SINGLE, size: 2, color: "000000" };
            const headerShading = { fill: "D9D9D9", type: ShadingType.CLEAR, color: "auto" };

            const createCell = (content, widthPct = null, bold = false, shading = null, colSpan = 1, rowSpan = 1) => {
                const paragraphs = [];
                if (typeof content === 'string') {
                    const lines = content.split('\n');
                    lines.forEach(line => {
                        paragraphs.push(new Paragraph({
                            children: [new TextRun({ text: line, bold: bold })],
                            spacing: { after: 50 }
                        }));
                    });
                } else if (Array.isArray(content)) {
                    content.forEach(p => paragraphs.push(p));
                }
                return new TableCell({
                    children: paragraphs,
                    width: widthPct ? { size: widthPct, type: WidthType.PERCENTAGE } : undefined,
                    shading: shading ? shading : undefined,
                    columnSpan: colSpan,
                    rowSpan: rowSpan,
                    verticalAlign: VerticalAlign.CENTER,
                    borders: { top: borderStyle, bottom: borderStyle, left: borderStyle, right: borderStyle }
                });
            };

            const processText = (text, isBold = false) => {
                if (!text) return "";
                return text;
            };

            // L√≥gica de Webconf
            const webconfType = document.getElementById('webconf_type').value;
            let webconfContent = "Ferramenta Padr√£o (Moodle)";
            if (webconfType === 'personalizado') {
                webconfContent = processText(document.getElementById('mat_webconf').value) || "Link Personalizado (N√£o informado)";
            }

            const introParagraphs = [
                new Paragraph({ children: [new TextRun({ text: "IMPORTANTE: ", bold: true }), new TextRun("O arquivo dever√° ser devidamente preenchido e enviado para o email atendimentosate@uece.br, criando assim um n√∫mero de chamado que entrar√° na fila da equipe do Moodle. A falta das informa√ß√µes necess√°rias vai acarretar o atraso na implanta√ß√£o da disciplina, que s√≥ seguira o processo depois de sanadas as pend√™ncias.")] }),
                new Paragraph({ text: "" }),
                new Paragraph({ children: [new TextRun("Toda e qualquer comunica√ß√£o e esclarecimento de d√∫vidas ser√° tratado no hist√≥rico do chamado, portanto √© necess√°rio o acompanhamento do solicitante.")] }),
                new Paragraph({ text: "" }),
                new Paragraph({ children: [new TextRun({ text: "Prazos:", bold: true })] }),
                new Paragraph({ children: [new TextRun("‚Ä¢ Implanta√ß√£o de Disciplinas: 14 dias √∫teis")] }),
                new Paragraph({ children: [new TextRun("‚Ä¢ Implanta√ß√£o de Provas Online: 45 dias √∫teis")] }),
                new Paragraph({ children: [new TextRun("‚Ä¢ Atendimento para suporte t√©cnico: 48 horas (equipe de suporte) - 72 horas (Coordena√ß√£o de AVA)")] }),
                new Paragraph({ text: "" })
            ];

            const tableIdent = new Table({
                width: { size: 100, type: WidthType.PERCENTAGE },
                rows: [
                    new TableRow({ children: [createCell("Identifica√ß√£o da disciplina", 100, true, headerShading, 4)] }),
                    new TableRow({ children: [createCell("Turma: " + processText(document.getElementById('id_turma').value), 50, false, null, 2), createCell("Semestre: " + processText(document.getElementById('id_semestre').value), 50, false, null, 2)] }),
                    new TableRow({ children: [createCell("Curso: " + processText(document.getElementById('id_curso').value), 100, false, null, 4)] }),
                    new TableRow({ children: [createCell("Disciplina: " + processText(document.getElementById('id_disciplina').value), 50, false, null, 2), createCell("Cr√©ditos: " + processText(document.getElementById('id_ch').value), 50, false, null, 2)] }),
                    new TableRow({ children: [createCell("Polos: " + processText(document.getElementById('id_polos').value), 100, false, null, 4)] })
                ]
            });

            const tableMat = new Table({
                width: { size: 100, type: WidthType.PERCENTAGE },
                rows: [
                    new TableRow({ children: [createCell("Material Biblioteca", 100, true, headerShading, 2)] }),
                    new TableRow({ children: [createCell("Link do livro:", 30, true), createCell(processText(document.getElementById('mat_livro').value), 70)] }),
                    new TableRow({ children: [createCell("Material adicional:", 30, true), createCell(processText(document.getElementById('mat_adicional').value), 70)] }),
                    new TableRow({ children: [createCell("\"Aten√ß√£o aos direitos autorais: a produ√ß√£o comercial ou a reprodu√ß√£o (mesmo parcial) n√£o autorizada s√£o, perante a Lei, pass√≠veis de puni√ß√£o nas esferas c√≠vel e criminal. Para que a obra seja utilizada √© necess√°ria a autoriza√ß√£o pr√©via do autor.\"", 100, false, null, 2)] }),
                    // Webconf com l√≥gica
                    new TableRow({ children: [createCell("Link Webconf (Sala virtual/RNP):", 30, true), createCell(webconfContent, 70)] })
                ]
            });

            const modRows = [new TableRow({ children: [createCell("M√≥dulos da disciplina", 100, true, headerShading, 2)] })];
            document.querySelectorAll('.item-card:not(.evaluation)').forEach((card, index) => {
                const modTitle = card.querySelector('.mod-tema').value;
                const modIntro = card.querySelector('.mod-intro').value;
                const uiTitle = card.querySelector('.item-title').textContent || `M√≥dulo ${index + 1}`;
                modRows.push(new TableRow({ children: [createCell(`${uiTitle}: ${modTitle}`, 100, true, headerShading, 2)] }));
                if (modIntro) modRows.push(new TableRow({ children: [createCell(processText(modIntro), 100, false, null, 2)] }));
                const resources = card.querySelectorAll('.resource-item');
                if (resources.length > 0) {
                    modRows.push(new TableRow({ children: [createCell("Tipo Recurso", 30, true, headerShading), createCell("Detalhes", 70, true, headerShading)] }));
                    resources.forEach(res => {
                        const type = res.querySelector('.res-type').value;
                        const title = res.querySelector('.res-title').value;
                        const desc = res.querySelector('.res-desc').value;
                        const method = res.querySelector('.eval-method').value;
                        let scoreText = method === 'Pontua√ß√£o' ? "Nota: " + res.querySelector('.val-score').value : (method === 'R√∫brica' ? "R√∫brica: " + res.querySelector('.val-rubric').value : "");
                        const startFull = formatDateTime(res.querySelector('.res-start-date').value, res.querySelector('.res-start-time').value, res.querySelector('.start-toggle').value);
                        const endFull = formatDateTime(res.querySelector('.res-end-date').value, res.querySelector('.res-end-time').value, res.querySelector('.end-toggle').value);
                        modRows.push(new TableRow({ children: [createCell(`${type}: ${title}`, 30, true), createCell(`Per√≠odo: ${startFull} a ${endFull}\n${scoreText ? scoreText + '\n' : ''}Descri√ß√£o: ${desc}`, 70, false)] }));
                    });
                }
            });
            const tableMods = new Table({ width: { size: 100, type: WidthType.PERCENTAGE }, rows: modRows });

            const avalRows = [new TableRow({ children: [createCell("AVALIA√á√ïES", 100, true, headerShading, 4)] })];
            avalRows.push(new TableRow({ children: [createCell("Identifica√ß√£o", 25, true), createCell("Per√≠odo", 25, true), createCell("Pontua√ß√£o", 15, true), createCell("Descri√ß√£o/Detalhes", 35, true)] }));
            document.querySelectorAll('.evaluation-item').forEach(evalItem => {
                const id = evalItem.querySelector('.eval-id').value;
                const startFull = formatDateTime(evalItem.querySelector('.eval-start-date').value, evalItem.querySelector('.eval-start-time').value, evalItem.querySelector('.start-toggle').value);
                const endFull = formatDateTime(evalItem.querySelector('.eval-end-date').value, evalItem.querySelector('.eval-end-time').value, evalItem.querySelector('.end-toggle').value);
                let scoreText = "-", descText = "-";
                if (id !== 'Autoavalia√ß√£o') {
                    const method = evalItem.querySelector('.eval-method').value;
                    scoreText = method === 'Pontua√ß√£o' ? evalItem.querySelector('.val-score').value : (method === 'R√∫brica' ? "R√∫brica" : "-");
                    descText = `Tipo: ${evalItem.querySelector('.eval-type').value}\n${evalItem.querySelector('.eval-desc').value}`;
                } else { descText = "Autoavalia√ß√£o padr√£o"; }
                avalRows.push(new TableRow({ children: [createCell(id, 25, true), createCell(`${startFull} a ${endFull}`, 25), createCell(scoreText, 15), createCell(descText, 35)] }));
            });
            const tableAval = new Table({ width: { size: 100, type: WidthType.PERCENTAGE }, rows: avalRows });

            // Tabela C√°lculo de Notas
            const tableCalc = new Table({
                width: { size: 100, type: WidthType.PERCENTAGE },
                rows: [
                    new TableRow({ children: [createCell("C√°lculo de Notas", 100, true, headerShading, 4)] }),
                    new TableRow({
                        children: [
                            createCell("NPC 1:", 20, true), createCell(processText(document.getElementById('calc_npc1').value), 30),
                            createCell("NPC 2:", 20, true), createCell(processText(document.getElementById('calc_npc2').value), 30)
                        ]
                    }),
                    new TableRow({
                        children: [
                            createCell("M√©dia Final:", 20, true), createCell(processText(document.getElementById('calc_media').value), 80, false, null, 3)
                        ]
                    })
                ]
            });

            const freqRows = [new TableRow({ children: [createCell("Distribui√ß√£o de Frequ√™ncia", 100, true, headerShading, 3)] })];
            freqRows.push(new TableRow({ children: [createCell("Data", 30, true), createCell("CH", 20, true), createCell("Descri√ß√£o", 50, true)] }));
            document.querySelectorAll('#freqTable tbody tr').forEach(tr => {
                const dataRaw = tr.querySelector('.freq-data').value;
                let dataFmt = dataRaw ? `${dataRaw.split('-')[2]}/${dataRaw.split('-')[1]}/${dataRaw.split('-')[0]}` : "";
                if (dataFmt || tr.querySelector('.freq-ch').value || tr.querySelector('.freq-desc').value) {
                    freqRows.push(new TableRow({ children: [createCell(dataFmt, 30), createCell(tr.querySelector('.freq-ch').value, 20), createCell(tr.querySelector('.freq-desc').value, 50)] }));
                }
            });
            freqRows.push(new TableRow({ children: [createCell("Total Carga Hor√°ria:", 50, true, null, 2), createCell(document.getElementById('total_ch').value, 50, true)] }));
            const tableFreq = new Table({ width: { size: 100, type: WidthType.PERCENTAGE }, rows: freqRows });

            const freqFooter = [new Paragraph({ children: [new TextRun("Obs.: A soma da carga hor√°ria deve ser igual a carga hor√°ria da disciplina")] }), new Paragraph({ children: [new TextRun("P.S: A carga hor√°ria m√°xima de uma atividade √© 23h.")] })];

            const doc = new Document({ sections: [{ children: [...introParagraphs, tableIdent, new Paragraph({ text: "" }), tableMat, new Paragraph({ text: "" }), tableMods, new Paragraph({ text: "" }), tableAval, new Paragraph({ text: "" }), tableCalc, new Paragraph({ text: "" }), tableFreq, ...freqFooter] }] });
            Packer.toBlob(doc).then(blob => { saveAs(blob, "Planejamento_Disciplina_UECE.docx"); });
        }

        // --- GERAR PDF ---
        function generatePDF() {
            const element = document.createElement('div');
            element.style.fontFamily = "'Plus Jakarta Sans', sans-serif";
            element.style.fontSize = "12px";
            element.style.color = "#000";
            element.style.lineHeight = "1.4";

            const getVal = (id) => document.getElementById(id).value || "---";
            const processText = (text) => text ? text.replace(/\n/g, '<br>') : "---";

            // L√≥gica de Webconf no PDF
            const webconfType = document.getElementById('webconf_type').value;
            let webconfContent = "Ferramenta Padr√£o (Moodle)";
            if (webconfType === 'personalizado') {
                webconfContent = getVal('mat_webconf');
            }

            let html = `
            <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #006935; padding-bottom: 10px;">
                <h2 style="color: #006935; margin: 0;">IMPLANTA√á√ÉO DE DISCIPLINA - SATE/UECE</h2>
            </div>
            <div style="font-size: 10px; margin-bottom: 20px; background: #f8fafc; padding: 10px; border: 1px solid #e2e8f0;">
                <p><strong>IMPORTANTE:</strong> O arquivo dever√° ser devidamente preenchido e enviado para o email atendimentosate@uece.br...</p>
                <p><strong>Prazos:</strong><br>‚Ä¢ Implanta√ß√£o de Disciplinas: 14 dias √∫teis<br>‚Ä¢ Implanta√ß√£o de Provas Online: 45 dias √∫teis<br>‚Ä¢ Suporte t√©cnico: 48h - 72h</p>
            </div>
        `;

            const tableStyle = "width: 100%; border-collapse: collapse; margin-bottom: 20px;";
            const thStyle = "background-color: #e2e8f0; padding: 8px; border: 1px solid #000; font-weight: bold; text-align: left;";
            const tdStyle = "padding: 8px; border: 1px solid #000;";

            // 1. Identifica√ß√£o
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">1. Identifica√ß√£o</h3>`;
            html += `<table style="${tableStyle}">
            <tr><td style="${thStyle}" colspan="2">Turma: <span style="font-weight:normal">${getVal('id_turma')}</span></td><td style="${thStyle}" colspan="2">Semestre: <span style="font-weight:normal">${getVal('id_semestre')}</span></td></tr>
            <tr><td style="${thStyle}" colspan="4">Curso: <span style="font-weight:normal">${getVal('id_curso')}</span></td></tr>
            <tr><td style="${thStyle}" colspan="2">Disciplina: <span style="font-weight:normal">${getVal('id_disciplina')}</span></td><td style="${thStyle}" colspan="2">Cr√©ditos: <span style="font-weight:normal">${getVal('id_ch')}</span></td></tr>
            <tr><td style="${thStyle}" colspan="4">Polos: <span style="font-weight:normal">${getVal('id_polos')}</span></td></tr>
        </table>`;

            // 2. Material
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">2. Material Did√°tico</h3>`;
            html += `<table style="${tableStyle}">
            <tr><td style="${thStyle}" width="30%">Livro (Biblioteca):</td><td style="${tdStyle}">${getVal('mat_livro')}</td></tr>
            <tr><td style="${thStyle}">Material Adicional:</td><td style="${tdStyle}">${processText(getVal('mat_adicional'))}</td></tr>
            <tr><td style="${tdStyle}" colspan="2" style="font-size:10px; font-style:italic;">"Aten√ß√£o aos direitos autorais..."</td></tr>
            <tr><td style="${thStyle}">Webconf:</td><td style="${tdStyle}">${webconfContent}</td></tr>
        </table>`;

            // 3. M√≥dulos
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">3. M√≥dulos</h3>`;
            html += `<table style="${tableStyle}">`;
            document.querySelectorAll('.item-card:not(.evaluation)').forEach((card, index) => {
                const titulo = card.querySelector('.mod-tema').value;
                const intro = card.querySelector('.mod-intro').value;
                const uiTitle = card.querySelector('.item-title').textContent || `M√≥dulo ${index + 1}`;
                html += `<tr><td style="${thStyle}" colspan="2" style="background-color: #d1fae5;">${uiTitle}: ${titulo}</td></tr>`;
                if (intro) html += `<tr><td style="${tdStyle}" colspan="2">${processText(intro)}</td></tr>`;
                const resources = card.querySelectorAll('.resource-item');
                if (resources.length > 0) {
                    html += `<tr><td style="${tdStyle} font-weight:bold; width:30%;">Recurso</td><td style="${tdStyle} font-weight:bold;">Detalhes</td></tr>`;
                    resources.forEach(res => {
                        const type = res.querySelector('.res-type').value;
                        const title = res.querySelector('.res-title').value;
                        const desc = res.querySelector('.res-desc').value;
                        const method = res.querySelector('.eval-method').value;
                        let scoreText = method === 'Pontua√ß√£o' ? "Nota: " + res.querySelector('.val-score').value : (method === 'R√∫brica' ? "R√∫brica: " + res.querySelector('.val-rubric').value : "");
                        const startFull = formatDateTime(res.querySelector('.res-start-date').value, res.querySelector('.res-start-time').value, res.querySelector('.start-toggle').value);
                        const endFull = formatDateTime(res.querySelector('.res-end-date').value, res.querySelector('.res-end-time').value, res.querySelector('.end-toggle').value);
                        html += `<tr><td style="${tdStyle}"><strong>${type}</strong><br>${title}</td><td style="${tdStyle}">Per√≠odo: ${startFull} a ${endFull}<br>${scoreText ? '<b>' + scoreText + '</b><br>' : ''}${processText(desc)}</td></tr>`;
                    });
                } else { html += `<tr><td style="${tdStyle}" colspan="2">Nenhum recurso cadastrado.</td></tr>`; }
            });
            html += `</table>`;

            // 4. Avalia√ß√µes
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">4. Avalia√ß√µes</h3>`;
            html += `<table style="${tableStyle}"><tr><td style="${thStyle}">ID</td><td style="${thStyle}">Per√≠odo</td><td style="${thStyle}">Pontua√ß√£o</td><td style="${thStyle}">Detalhes</td></tr>`;
            document.querySelectorAll('.evaluation-item').forEach(evalItem => {
                const id = evalItem.querySelector('.eval-id').value;
                const startFull = formatDateTime(evalItem.querySelector('.eval-start-date').value, evalItem.querySelector('.eval-start-time').value, evalItem.querySelector('.start-toggle').value);
                const endFull = formatDateTime(evalItem.querySelector('.eval-end-date').value, evalItem.querySelector('.eval-end-time').value, evalItem.querySelector('.end-toggle').value);
                let scoreText = "-", descText = "-";
                if (id !== 'Autoavalia√ß√£o') {
                    const method = evalItem.querySelector('.eval-method').value;
                    scoreText = method === 'Pontua√ß√£o' ? evalItem.querySelector('.val-score').value : (method === 'R√∫brica' ? "R√∫brica" : "-");
                    descText = `Tipo: ${evalItem.querySelector('.eval-type').value}<br>${processText(evalItem.querySelector('.eval-desc').value)}`;
                } else { descText = "Padr√£o"; }
                html += `<tr><td style="${tdStyle}">${id}</td><td style="${tdStyle}">${startFull}<br>a ${endFull}</td><td style="${tdStyle}">${scoreText}</td><td style="${tdStyle}">${descText}</td></tr>`;
            });
            html += `</table>`;

            // 5. C√°lculo de Notas
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">5. C√°lculo de Notas</h3>`;
            html += `<table style="${tableStyle}">
            <tr>
                <td style="${thStyle}">NPC 1:</td><td style="${tdStyle}">${getVal('calc_npc1')}</td>
                <td style="${thStyle}">NPC 2:</td><td style="${tdStyle}">${getVal('calc_npc2')}</td>
            </tr>
            <tr><td style="${thStyle}">M√©dia Final:</td><td style="${tdStyle}" colspan="3">${processText(getVal('calc_media'))}</td></tr>
        </table>`;

            // 6. Frequ√™ncia
            html += `<h3 style="color: #006935; border-bottom: 1px solid #006935; padding-bottom: 5px;">6. Frequ√™ncia</h3>`;
            html += `<table style="${tableStyle}"><tr><td style="${thStyle}">Data</td><td style="${thStyle}">CH</td><td style="${thStyle}">Descri√ß√£o</td></tr>`;
            document.querySelectorAll('#freqTable tbody tr').forEach(tr => {
                const dataRaw = tr.querySelector('.freq-data').value;
                let dataFmt = dataRaw ? `${dataRaw.split('-')[2]}/${dataRaw.split('-')[1]}/${dataRaw.split('-')[0]}` : "";
                if (dataFmt || tr.querySelector('.freq-ch').value || tr.querySelector('.freq-desc').value) {
                    html += `<tr><td style="${tdStyle}">${dataFmt}</td><td style="${tdStyle}">${tr.querySelector('.freq-ch').value}</td><td style="${tdStyle}">${tr.querySelector('.freq-desc').value}</td></tr>`;
                }
            });
            html += `<tr><td style="${thStyle}" colspan="1">Total CH:</td><td style="${tdStyle}" colspan="2"><strong>${document.getElementById('total_ch').value}</strong></td></tr></table>`;

            element.innerHTML = html;

            html2pdf().set({
                margin: 10,
                filename: 'Planejamento_Disciplina_UECE.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).from(element).save();
        }
    </script>

</body>

</html>